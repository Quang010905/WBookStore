@{
    ViewBag.Title = "Product Management";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="container-fluid">
    <h2 class="mb-4">📦 Product Image List</h2>
    <p>
        <a href="@Url.Action("Add", "ProductImage", new {id = ViewBag.proId})" class="btn btn-primary">Create Image</a>
    </p>
    <!-- Alert Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

<div class="form-group mb-3">
    <label>Product</label>
    <input type="text" value="@ViewBag.proName" class="form-control" disabled />
    <input type="hidden" value="@ViewBag.proId" name="proId" class="form-control" disabled />
</div>
    <div class="form-group mb-3">
        <a class="btn btn-secondary" href="@Url.Action("Index", "Product")">
            Back
        </a>
    </div>
    <!-- Product Table -->
    @if (ViewBag.listProImage != null)
    {
        var ls = (List<WBookStore.Models.ModelViews.ProductImageView>)ViewBag.listProImage;
        if (ls != null && ls.Count > 0)
        {
            int i = 1;
            <div class="card shadow">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered text-center">
                            <thead class="thead-dark">
                                <tr>
                                    <th>No</th>
                                    <th>Image & Index</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ls)
                                {
                                    <tr>
                                        <th scope="row">@i</th>
                                        <td>
                                            <form action="@Url.Action("Update", "ProductImage",new { id = item.Id, proId = item.proId }))"
                                                  method="post" id="form-@item.Id" enctype="multipart/form-data"
                                                  class="d-flex flex-column align-items-start">
                                                <!-- đổi center -> start -->

                                                <input type="hidden" name="id" value="@item.Id" />
                                                <input type="hidden" name="OldImage" value="@item.Image" />
                                                <input type="hidden" name="proId" value="@item.proId" />

                                                <!-- Hình ảnh -->
                                                <img src="@Url.Content("~/Content/Image/" + item.Image)"
                                                     class="img-thumbnail mb-2"
                                                     style="max-width: 120px; max-height: 120px;" />

                                                <!-- Chọn file -->
                                                <input type="file" id="upFile" name="upFile"
                                                       class="form-control-file mb-2" />

                                                <!-- Index -->
                                                <input type="number" name="Index" value="@item.Index" min="1"
                                                       class="form-control" style="width: 80px;" />
                                            </form>
                                        </td>



                                        <td>
                                            <button type="submit"
                                                    form="form-@item.Id" style="background: none; border: none; padding: 0; cursor: pointer;">
                                                <img src="@Url.Content("~/Content/Icon/update.png")" style="width:1vw; height:2vh;"/>
                                            </button>

                                            <a href="@Url.Action("Delete", "ProductImage", new {id = item.Id, proId = item.proId})" onclick="return confirm('Are you sure to delete this image?')">
                                                <img src="@Url.Content("~/Content/Icon/delete.png")" style="width:1vw; height:2vh;" />
                                            </a>
                                        </td>
                                    </tr>
                                    i++;
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1, search = ViewBag.Search })">Previous</a>
                    </li>

                    @for (int j = 1; j <= ViewBag.TotalPages; j++)
                    {
                        <li class="page-item @(j == ViewBag.CurrentPage ? "active" : "")">
                            <a class="page-link" href="@Url.Action("Index", new { page = j, search = ViewBag.Search })">@j</a>
                        </li>
                    }

                    <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1, search = ViewBag.Search })">Next</a>
                    </li>
                </ul>
            </nav>
        }
        else
        {
            <div class="alert alert-info text-center">
                No Product Image Found.
            </div>
        }
    }
</div>
