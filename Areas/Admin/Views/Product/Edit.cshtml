
@{
    ViewBag.Title = "Edit";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<h2>Edit</h2>
@section headerContent
{
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.3.1017/styles/kendo.common-material.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.3.1017/styles/kendo.material.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.3.1017/styles/kendo.material.mobile.min.css" />
}
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}
@if (ViewBag.itemProduct != null)
{
    WBookStore.Models.ModelViews.ProductView pro = (WBookStore.Models.ModelViews.ProductView)ViewBag.itemProduct;
    <form action="@Url.Action("Update", "Product", new {id = pro.Id})" method="post" enctype="multipart/form-data">
        <input type="hidden" name="_method" value="PUT" />
        <div class="form-group mb-3">
            <label>Product Name </label>
            <input type="text" name="name" value="@pro.Name" id="Name" class="form-control" required/>
        </div>
        @{
            var priceFormatted = string.Format("{0:#,0}", pro.Price).Replace(",", ".");
            var quantityFormatted = string.Format("{0:#,0}", pro.Quantity).Replace(",", ".");
        }
        <div class="form-group mb-3">
            <label>Product Price </label>
            <input type="text" value="@priceFormatted" id="proPriceFormatted" class="form-control" required/>
            <input type="hidden" name="price" id="price" value="@pro.Price" />
        </div>
        <div class="form-group mb-3">
            <label>Product Quantity </label>
            <input type="text" value="@quantityFormatted" class="form-control" id="proQuantityFormatted" required/>
            <input type="hidden" name="quantity" id="quantity" value="@pro.Quantity" />
        </div>
        <div class="form-group mb-3">
            <label>Active</label><br />
            <input type="checkbox" name="active" value="1" @(pro.Active == 1 ? "checked" : "") />
            <label class="form-check-label" for="Active">Enable</label>
        </div>
        <div>
            <label class="form-group mb-3">Story Type</label>
            <select name="type" id="type" class="form-control" required>
                <option value="">-- Select story type --</option>
                <option value="1" @(ViewBag.type == 1 ? "selected" : "")>Comic</option>
                <option value="2" @(ViewBag.type == 2 ? "selected" : "")>Novel</option>
            </select>
        </div>
        @{
            var currentCate = ((WBookStore.Models.ModelViews.ProductView)ViewBag.itemProduct).category_id;
        }
        <div>
            <label class="form-group mb-3">Category</label>
            <select name="cateId" id="cateId" class="form-control" required>
                <option value="">-- Select category --</option>
                @if (ViewBag.Categories != null)
                {
                    var ls = (List<WBookStore.Models.ModelViews.CategoryView>)ViewBag.Categories;
                    foreach (var item in ls)
                    {
                        <option value="@item.Id" @(item.Id == (int)currentCate ? "selected" : "")>@item.Name</option>
                    }
                }
            </select>
        </div>
        <div>
            <label>Description</label>
            <textarea id="Description" name="description">@pro.Description</textarea>
        </div>
        <div>
            <label>Image</label>
            <img src=@Url.Content("~/Content/Image/" + pro.Image) style="max-width: 200px; max-height: 200px; display: block; margin-bottom: 10px" />
            <input type="file" id="upFile" name="upFile" />
            <input type="hidden" name="OldImage" value="@pro.Image" />
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="@Url.Action("Index", "Product")" class="btn btn-secondary">Back</a>
        </div>
    </form>

}
@section scripts
{
    <script src="https://kendo.cdn.telerik.com/2018.3.1017/js/jquery.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2018.3.1017/js/kendo.all.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            var editor = $("#Description").kendoEditor({
                tools: [
                    "bold",
                    "italic",
                    "underline",
                    "strikethrough",
                    "justifyLeft",
                    "justifyCenter",
                    "justifyRight",
                    "justifyFull",
                    "insertUnorderedList",
                    "insertOrderedList",
                    "indent",
                    "outdent",
                    "createLink",
                    "unlink",
                    "insertImage",
                    "insertFile",
                    "subscript",
                    "superscript",
                    "tableWizard",
                    "addRowAbove",
                    "addRowBelow",
                    "addColumnLeft",
                    "addColumnRight",
                    "deleteRow",
                    "deleteColumn",
                    "viewHtml",
                    "formatting",
                    "cleanFormatting",
                    "fontName",
                    "fontSize",
                    "foreColor",
                    "backColor",
                    "print",
                ]
            }).data("kendoEditor");

            $("form").on("submit", function (e) {
                var content = editor.value().trim();
                var description = document.getElementById('Description').value.trim();
                if (!content || !description) {
                    e.preventDefault();
                    alert("Please enter description");
                    return false;
                }
            });
        });
    </script>
    <script>
        function setupFormattedInput(formattedId, hiddenId) {
            const formattedInput = document.getElementById(formattedId);
            const hiddenInput = document.getElementById(hiddenId);

            formattedInput.addEventListener('input', function () {
                // Xóa các ký tự không phải số
                let raw = this.value.replace(/\D/g, '');

                // Gán giá trị thật vào input ẩn
                hiddenInput.value = raw;

                // Hiển thị lại có dấu chấm hàng nghìn
                this.value = raw.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            });
        }

        // Gọi hàm cho cả quantity và price
        setupFormattedInput('proQuantityFormatted', 'quantity');
        setupFormattedInput('proPriceFormatted', 'price');
    </script>
}


